<?xml version="1.0" encoding="UTF-8"?>
<excelConfig>
	<parameters>
		<!--保存时使用的模板,根据配置文件生成的excel,需要将数据保存为excel到本地,然后有save方法,再生成sql,保存到本地-->
		<parameter name="outputFilePath" value="C:\temo\OUT.xlsx" isShow="1"/>
		<!--<parameter isShow="1" name="template_FilePath" value="C:\00_Project\Jeesite070310\src\main\java\com\thinkgem\jeesite\common\excelConfig\test\xlsx\erp\enter\computer\computer.xlsx"/>-->
		<parameter isShow="1" name="template_FilePath" value="destroy.xlsx"/>
		<parameter isShow="1" name="temlateSyntax" value="false"/>
	</parameters>
	<models cls="">
		<!--
			引用多数据源,
			配置了全局参数
		-->
		<!--查询-->
		<model  id="assetTypeQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT F_ID, F_TITLE FROM T_TAILOR_FORM ORDER BY F_TITLE
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="departmentQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT name FROM sys_office GROUP BY name
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="personQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT EName, EmployeeID FROM IT_User WHERE LEFT(EmployeeID ,1)='Z' ORDER  BY EName
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<!--保存-->
		<model  id="assetSave">
			<parameters >
				<parameter name="status" class="java.lang.String"   value="$F!{status}"/>
				<parameter name="QTY" class="java.lang.String"   value="$F!{QTY}"/>
				<parameter name="Series" class="java.lang.String"   value="$F!{Series}"/>
				<parameter name="Type" class="java.lang.String"   value="$F!{Type}"/>
				<parameter name="userId" class="java.lang.String" value="@@USERID"/>
			</parameters>
			<SQLStrs>
				<!--条件判断语句,根据类型,依次做出更新,如果无固定资产编号(鼠标、键盘等),更新数量,数量减;如果有固定资产编号,更新状态-->
				<sqlStr>
					<![CDATA[

						declare @error_mes varchar(1000)
						IF
							'$P!{Type}' IN ( 'A3','A4','A5','A7','A8','A9')
						BEGIN
						IF (SELECT qty-$P!{QTY} FROM IT_Asset WHERE type='$P!{Type}') <=1 OR (SELECT qty FROM IT_Asset WHERE type='$P!{Type}') IS NULL
							BEGIN
								set @error_mes= (SELECT '目前库中$P!{TypeDesc}剩余数量为'+CAST(qty AS VARCHAR(8))+',请修改数量后再借用' FROM IT_Asset WHERE type='$P!{Type}')
								raiserror(@error_mes,16,1)
							END ELSE
							BEGIN
							UPDATE IT_Asset SET Qty = Qty-$P!{QTY} WHERE Type='$P!{Type}'
							END

						END ELSE
						BEGIN
							UPDATE IT_Asset SET Field2 = '$P!{status}' WHERE SerialNo='$P!{Series}'
						END
					]]>
				</sqlStr>
			</SQLStrs>
		</model>

		<model  id="transactionSave">
			<parameters >
				<parameter name="status" class="java.lang.String"   value="$F!{status}"/>
				<parameter name="assetSerialNo" class="java.lang.String"   value="$F!{assetSerialNo}"/>
				<parameter name="qty" class="java.lang.String"   value="$F!{qty}"/>
				<parameter name="assetType" class="java.lang.String"   value="$F!{assetType}"/>
				<parameter name="currentEmployeeID" class="java.lang.String"   value="$F!{currentEmployeeID}"/>
				<parameter name="currentEmployeeName" class="java.lang.String"   value="$F!{currentEmployeeName}"/>
				<parameter name="outDate" class="java.lang.String"   value="$F!{outDate}"/>
				<parameter name="userId" class="java.lang.String" value="@@USERID"/>
			</parameters>
			<SQLStrs>
				<sqlStr>
					<![CDATA[
					IF
							rtrim(ltrim('$P!{currentEmployeeName}')) =''
							or rtrim(ltrim('$P!{currentEmployeeID}')) =''
							or rtrim(ltrim('$P!{currentEmployeeID}')) ='NULL'
							or rtrim(ltrim('$P!{currentEmployeeID}')) ='NULL'
						BEGIN
							 INSERT INTO dbo.IT_Transaction (outDate,id, TransactionDate, TransactionType, beforeEmployeeID, beforeEmployeeName,currentEmployeeID,currentEmployeeName ,assetSerialNo, QTY, assetType,  create_by, create_date, update_by, update_date, remarks, del_flag)
											VALUES ('$P!{outDate}',newId(), getDate(), '$P!{status}',null, 'IT库房',null, 'IT库房', '$P!{assetSerialNo}', '$P!{qty}', '$P!{assetType}', '$P!{userId}', getDate(), '$P!{userId}', getDate(), '', '0')

						END ELSE
						BEGIN
							 INSERT INTO dbo.IT_Transaction (outDate,id, TransactionDate, TransactionType, beforeEmployeeID, beforeEmployeeName,currentEmployeeID,currentEmployeeName ,assetSerialNo, QTY, assetType,  create_by, create_date, update_by, update_date, remarks, del_flag)
											VALUES ('$P!{outDate}',newId(), getDate(), '$P!{status}',null, 'IT库房','$P!{currentEmployeeID}', '$P!{currentEmployeeName}', '$P!{assetSerialNo}', '$P!{qty}', '$P!{assetType}', '$P!{userId}', getDate(), '$P!{userId}', getDate(), '', '0')

						END
						]]>
				</sqlStr>
			</SQLStrs>
		</model>
	</models>
	<!--查询视图-->
	<views   action="query">
		<view modelid="assetTypeQuery" sheetName="数据字典"   top="2" left="0">
			<propertys>
				<property 	cellIndex="0,0" feild="F_TITLE" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="F_ID" 	type="java.lang.String"/>
			</propertys>
		</view>
		<view modelid="departmentQuery" sheetName="数据字典"   top="2" left="2">
			<propertys>
				<property 	cellIndex="0,1" feild="name" 	type="java.lang.String"/>
			</propertys>
		</view>
		<view modelid="personQuery" sheetName="数据字典"   top="2" left="4">
			<propertys>
				<property 	cellIndex="0,1" feild="EName" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="EmployeeID" 	type="java.lang.String"/>
			</propertys>
		</view>
	</views>
	<!--保存视图-->
	<views   action="save">
		<view modelid="assetSave" sheetName="mouseAndKeyboard"  top="6" left="0">
			<propertys>
				<property cellIndex="0,1" feild="status" required ="-1"	type="java.lang.String" />
				<property cellIndex="0,1" feild="Type" required ="-1"	type="java.lang.String" />
				<property cellIndex="0,2" feild="Series" required ="-1"	type="java.lang.String" />
				<property cellIndex="0,1" feild="QTY" required ="1"	type="java.lang.String" />
				<property cellIndex="0,1"	feild="userId" required ="-1"	type="java.lang.String" />
			</propertys>
		</view>
		<view modelid="transactionSave"  top="6" left="0">
			<propertys>
				<property 	cellIndex="0,1"	feild="status" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="assetType" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,2"	feild="assetSerialNo" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="qty" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="currentEmployeeID" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="currentEmployeeName" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="outDate" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="userId" required ="-1"	type="java.lang.String" />
			</propertys>
		</view>
	</views>
</excelConfig>