<?xml version="1.0" encoding="UTF-8"?>
<excelConfig>
	<parameters>
		<!--保存时使用的模板,根据配置文件生成的excel,需要将数据保存为excel到本地,然后有save方法,再生成sql,保存到本地-->
		<parameter name="outputFilePath" value="C:\temo\OUT.xlsx" isShow="1"/>
		<!--<parameter isShow="1" name="template_FilePath" value="C:\00_Project\Jeesite070310\src\main\java\com\thinkgem\jeesite\common\excelConfig\test\xlsx\erp\enter\computer\computer.xlsx"/>-->
		<parameter isShow="1" name="template_FilePath" value="recieve.xlsx"/>
		<parameter isShow="1" name="temlateSyntax" value="false"/>
		<parameter isShow="0" name="assetSerialType" class="java.lang.String" htmlType="select" desc="固定资产类型" isRequired="1" value="" modelId="assetOnePartTypeQuery" />
		<parameter isShow="0" name="assetSerialNo" class="java.lang.String" htmlType="input" desc="SN" isRequired="1" value="" modelId="" />
		<parameter isShow="0" name="EDP" class="java.lang.String" htmlType="input" desc="EDP" isRequired="1" value="" modelId="" />
		<parameter isShow="0" name="ExpressCode" class="java.lang.String" htmlType="input" desc="快速服务编码" isRequired="1" value="" modelId="" />
	</parameters>
	<models cls="">
		<!--
			引用多数据源,
			配置了全局参数
		-->
		<!--查询-->
		<model  id="assetTypeQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT F_ID, F_TITLE FROM T_TAILOR_FORM ORDER BY F_TITLE
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="departmentQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT name FROM sys_office GROUP BY name
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="personQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT EName, EmployeeID FROM IT_User WHERE LEFT(EmployeeID ,1)='Z' ORDER  BY EName
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="assetOnePartTypeQuery">
			<SQLStrs>
				<sqlStr>
					<![CDATA[
						SELECT rtrim(ltrim(F_ID)) value, rtrim(ltrim(F_TITLE)) name FROM T_TAILOR_FORM WHERE F_ID not in ('A1','A2','A6','A8','A9')  ORDER BY F_TITLE
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<model  id="singleAssetQuery">
			<parameters>
				<parameter name="assetSerialType" class="java.lang.String"  value="$P!{assetSerialType}" />
				<parameter name="assetSerialNo" class="java.lang.String"  value="$P!{assetSerialNo}" />
				<parameter name="EDP" class="java.lang.String"  value="$P!{EDP}" />
				<parameter name="ExpressCode" class="java.lang.String"  value="$P!{ExpressCode}" />
			</parameters>
			<SQLStrs>
				<sqlStr>
					<![CDATA[

					SELECT * FROM IT_Asset WHERE 1=1
					<#if assetSerialType?? && assetSerialType != "">
							 AND Type LIKE '%$P!{assetSerialType}%'
					</#if>
					<#if assetSerialNo?? && assetSerialNo != "">
							 AND SerialNo LIKE '%$P!{assetSerialNo}%'
					</#if>
						<#if EDP?? && EDP != "">
							 AND EDP LIKE '%$P!{EDP}%'
					</#if>
					<#if ExpressCode?? && ExpressCode != "">
							 AND ExpressCode LIKE '%$P!{ExpressCode}%'
					</#if>
					]]>
				</sqlStr>
			</SQLStrs>
		</model>
		<!--保存-->
		<model  id="assetSave">
			<parameters >
				<parameter name="status" class="java.lang.String"   value="$F!{status}"/>
				<parameter name="QTY" class="java.lang.String"   value="$F!{QTY}"/>
				<parameter name="SeriesNo" class="java.lang.String"   value="$F!{SeriesNo}"/>
				<parameter name="Type" class="java.lang.String"   value="$F!{Type}"/>
				<parameter name="userid" class="java.lang.String" value="@@Userid"/>
			</parameters>
			<!--
						-->
			<SQLStrs>
				<!--条件判断语句,根据类型,依次做出更新,如果无固定资产编号(鼠标、键盘等),更新数量,数量减;如果有固定资产编号,更新状态-->
				<sqlStr>
					<![CDATA[
						declare @error_mes varchar(1000)
						IF
							'$P!{Type}' IN ( 'A3','A4','A5','A7','A8','A9')
						BEGIN
						IF (SELECT qty-$P!{QTY} FROM IT_Asset WHERE type='$P!{Type}') <=1 OR (SELECT qty FROM IT_Asset WHERE type='$P!{Type}') IS NULL
							BEGIN
								set @error_mes= (SELECT '目前库中$P!{TypeDesc}剩余数量为'+CAST(qty AS VARCHAR(8))+',请修改数量后再领用' FROM IT_Asset WHERE type='$P!{Type}')
								raiserror(@error_mes,16,1)
							END ELSE
							BEGIN
							UPDATE IT_Asset SET Qty = Qty-$P!{QTY} WHERE Type='$P!{Type}'
							END

						END ELSE
						BEGIN
							IF '入库'= (SELECT Field2 FROM IT_Asset WHERE SerialNo='$P!{SeriesNo}')
								or '归还'= (SELECT Field2 FROM IT_Asset WHERE SerialNo='$P!{SeriesNo}')
								BEGIN
									UPDATE IT_Asset SET Field2 = '$P!{status}' WHERE SerialNo='$P!{SeriesNo}'
								END ELSE
								BEGIN
									set @error_mes= (SELECT '固定资产编号为:'+SerialNo+'的资产现状态为:'+Field2+',无法领用' FROM IT_Asset WHERE SerialNo='$P!{SeriesNo}')
									raiserror(@error_mes,16,1)
								END
						END
					]]>
				</sqlStr>
			</SQLStrs>
		</model>

		<model  id="transactionSave">
			<parameters >
				<parameter name="status" class="java.lang.String"   value="$F!{status}"/>
				<parameter name="assetserialno" class="java.lang.String"   value="$F!{assetserialno}"/>
				<parameter name="qty" class="java.lang.String"   value="$F!{qty}"/>
				<parameter name="assettype" class="java.lang.String"   value="$F!{assettype}"/>
				<parameter name="Remark" class="java.lang.String"   value="$F!{Remark}"/>
				<parameter name="currentEmployeeID" class="java.lang.String"   value="$F!{currentEmployeeID}"/>
				<parameter name="currentEmployeeName" class="java.lang.String"   value="$F!{currentEmployeeName}"/>
				<parameter name="userid" class="java.lang.String" value="@@Userid"/>
			</parameters>
			<SQLStrs>
				<sqlStr>
					<![CDATA[
					  INSERT INTO dbo.IT_Transaction (outDate,id, TransactionDate, TransactionType, beforeEmployeeID, beforeEmployeeName,currentEmployeeID,currentEmployeeName ,assetSerialNo, QTY, assetType, Remark, create_by, create_date, update_by, update_date, remarks, del_flag)
											VALUES (getdate(),newid(), getdate(), '$P!{status}',null, 'IT库房','$P!{currentEmployeeID}', '$P!{currentEmployeeName}', '$P!{assetserialno}', '$P!{qty}', '$P!{assettype}','$P!{Remark}',  '$P!{userid}', getdate(), '$P!{userid}', getdate(), '', '0')
			        ]]>
				</sqlStr>
			</SQLStrs>
		</model>
	</models>
	<!--查询视图-->
	<views   action="query">
		<view modelid="assetTypeQuery" sheetName="数据字典"   top="2" left="0">
			<propertys>
				<property 	cellIndex="0,0" feild="F_TITLE" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="F_ID" 	type="java.lang.String"/>
			</propertys>
		</view>
		<view modelid="departmentQuery" sheetName="数据字典"   top="2" left="2">
			<propertys>
				<property 	cellIndex="0,1" feild="name" 	type="java.lang.String"/>
			</propertys>
		</view>
		<view modelid="personQuery" sheetName="数据字典"   top="2" left="4">
			<propertys>
				<property 	cellIndex="0,1" feild="EName" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="EmployeeID" 	type="java.lang.String"/>
			</propertys>
		</view>
		<view modelid="singleAssetQuery" sheetName="固定资产领用单"   top="6" left="1">
			<propertys>
				<property 	cellIndex="0,1" feild="TYPE" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="StockCode" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="SerialNo" 	type="java.lang.String"/>
				<property 	cellIndex="0,1" feild="QTY" 	type="java.lang.String"/>
			</propertys>
		</view>
	</views>
	<!--保存视图-->
	<views   action="save">
		<view modelid="assetSave" sheetName="mouseAndKeyboard"  top="6" left="0">
			<propertys>
				<property cellIndex="0,1" feild="status" required ="1"	type="java.lang.String" />
				<property cellIndex="0,1" feild="Type" required ="-1"	type="java.lang.String" />
				<property cellIndex="0,2" feild="SeriesNo" required ="-1"	type="java.lang.String" />
				<property cellIndex="0,1" feild="QTY" required ="1"	type="java.lang.String" />
				<property cellIndex="0,1"	feild="userid" required ="-1"	type="java.lang.String" />
			</propertys>
		</view>
		<view modelid="transactionSave"  top="6" left="0">
			<propertys>
				<property 	cellIndex="0,1"	feild="status" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="assettype" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,2"	feild="assetserialno" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="qty" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="Remark" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,2"	feild="currentEmployeeID" required ="-1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="currentEmployeeName" required ="1"	type="java.lang.String" />
				<property 	cellIndex="0,1"	feild="userid" required ="-1"	type="java.lang.String" />
			</propertys>
		</view>
	</views>
</excelConfig>